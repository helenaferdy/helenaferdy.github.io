---
title: Palo Alto - SSL Forward Proxy
date: 2023-09-21 17:30:00 +0700
categories: [Security, Palo Alto]
tags: [Palo Alto]
---

<br>

## What is SSL Forward Proxy?

An SSL Forward Proxy, also known as an SSL Inspection or Decryption Proxy, is a network security device that intercepts and inspects encrypted SSL/TLS traffic between a client and a web server on the internet. SSL Forward Proxy does a deep packet inspection and monitoring of encrypted network traffic for security, compliance, and policy enforcement reasons.


![x](/static/2023-09-21-ssl/00.png)


<br>
<br>

## Importing Trusted Root CA

First download the Root-CA from the CA server

![x](/static/2023-09-21-ssl/01.png)

<br>

Then on Palo Alto, go to Device >> Certificates >> Import

![x](/static/2023-09-21-ssl/02.png)

<br>

And then select "Trusted Root CA"

![x](/static/2023-09-21-ssl/03.png)

<br>
<br>

## Generating and Signing CSR

Next let's generate a CSR for the Firewall, on the same page click Generate

![x](/static/2023-09-21-ssl/04.png)

> CSR (Certificate Signing Request) is a message generated by a server to apply for a SSL/TLS certificate to the CA (Certificate Authority)

<br>

Export the CSR by selecting Export Certificate

![x](/static/2023-09-21-ssl/05.png)

<br>

Next Sign the CSR on the CA Server, use "Subordinate Certificate Authority" template

![x](/static/2023-09-21-ssl/06.png)

> A Subordinate Certificate Authority (Sub-CA) is a lower-level entity in a PKI hierarchy, issuing certificates under the authority of a higher-level CA.

<br>

Import the Certificate to Palo Alto

![x](/static/2023-09-21-ssl/07.png)

<br>

Select the paloalto cert, select "Forward Trust Certificate" and "Forward Untrust Certificate"

![x](/static/2023-09-21-ssl/07a.png)

<br>

And this is what we end up with

![x](/static/2023-09-21-ssl/08.png)

<br>
<br>

## Creating Decryption Policy

First create a Decryption Profile, on Objects >> Decryption Profile, create new <br>
Here we create the rule of which connection should be allowed or not based on the target server's certificate.

![x](/static/2023-09-21-ssl/09.png)

<br>

Next we create the Decryption Policy, on Policies >> Decryption, create new

![x](/static/2023-09-21-ssl/10.png)

> Give it a name

![x](/static/2023-09-21-ssl/11.png)

> Select Inside Zone as the source

![x](/static/2023-09-21-ssl/12.png)

> Select Outside Zone as the destination

![x](/static/2023-09-21-ssl/13.png)

> Select Decrypt with the newly created Decryption Profile

<br>
<br>

## Testing the SSL Forward Proxy

Before testing, make sure the machine on the inside network also trusts the Root CA

![x](/static/2023-09-21-ssl/14.png)

<br>

Now if we access anything on the internet, we'll see the certificate issuer being the paloalto, meaning paloalto decrypts, inspects, and re-encrypts the traffic before it being forwarded to the actual destination

![x](/static/2023-09-21-ssl/15.png)

<br>

Looking at certificate hierarchy, we can see the PKI Heirarchy, where paloalto.helena.gg acts as a Sub-CA of HELENA-CA, issuing certificate for twitter.com

![x](/static/2023-09-21-ssl/16.png)

<br>

On the Decryption Policy, we can see the hit counter going up

![x](/static/2023-09-21-ssl/17.png)

<br>

On Monitor >> Decryption, we can see all the decrypted traffic

![x](/static/2023-09-21-ssl/18.png)

<br>

Now if we try accessing sites with bad certificate, we should see a warning not allowing the access

![x](/static/2023-09-21-ssl/19.png)

<br>

On ACC >> SSL Activity, we can see the overall SSL Decryption stats, as well as the sites that are not allowed to be accessed because of bad certificates

![x](/static/2023-09-21-ssl/20.png)

<br>