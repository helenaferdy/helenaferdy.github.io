---
title: GCP Load Balancer with Cloud Armor
date: 2025-12-10 07:30:00 +0700
categories: [Cloud, Google Cloud Platform (GCP)]
tags: [GCP]
---

GCP Load balancer allows us to distribute incoming traffic globally across multiple backend instances, ensuring high availability and seamless scalability, on top of that we can also apply Cloud Armor to enforce security policies, such as Geo-blocking, Rate Limiting, and WAF rules, directly at the network edge before traffic reaches our backends


## Load Balancer

Here we have 2 linux servers serving web on port 8080, the goal is to load balance these 2 so i can be accessed on port 80 in front of the load balancer

![x](/static/2025-12-10-gcp-lb/01.png)

![x](/static/2025-12-10-gcp-lb/02.png)

<br>

Next we create an Unmanaged Instance Group to contain these 2 linux servers

![x](/static/2025-12-10-gcp-lb/03.png)

![x](/static/2025-12-10-gcp-lb/04.png)

<br>

After that we create the Application Load Balancer


![x](/static/2025-12-10-gcp-lb/05.png)

> * Application Load Balancer (L7: HTTP/HTTPS): This is a full proxy that operates at the application layer. It understands the request's content (URL, headers, cookies), enabling advanced routing logic and SSL termination. This type is mandatory for using Cloud Armor's WAF features (like blocking SQLi or XSS) because it can inspect the HTTP payload.
> * Network Load Balancer (L4: TCP/UDP/SSL): This operates at the transport layer and can be a passthrough or a proxy. It is simpler and faster, focusing on IP and port distribution. Best for high-speed, non-HTTP/S traffic (like gaming or VPN).

<br>

Then we select the External Load Balancer

![x](/static/2025-12-10-gcp-lb/06.png)

<br>

And here we select Global for simplicity

![x](/static/2025-12-10-gcp-lb/07.png)

<br>

Next we select the Global External Application Load Balancer

![x](/static/2025-12-10-gcp-lb/08.png)

> * Global External Application Load Balancer (New/Modern): This is the newer, recommended choice for global workloads. It utilizes the Envoy proxy technology and offers Advanced Traffic Management features, such as traffic splitting (weight-based) and request/response header transformations.
> * Classic Application Load Balancer (Legacy): This is the previous generation of the global external Load Balancer. It only supports Basic Traffic Management.

<br>

And then we can create the Load Balancer

![x](/static/2025-12-10-gcp-lb/09.png)

<br>

After that we need to configure the Frontend, give it name and set the front facing port and IP Address

![x](/static/2025-12-10-gcp-lb/10.png)

<br>

Next we configure the Backend, here we create a new Backend Service that points to the Instance Group we created earlier on port 8080. Here we also disable any Cloud Armor policy because we'll configure it later.

![x](/static/2025-12-10-gcp-lb/11.png)

![x](/static/2025-12-10-gcp-lb/12.png)

<br>

Then configure the Routing Rules, the default one should work fine

![x](/static/2025-12-10-gcp-lb/13.png)

<br>

Review and finalize

![x](/static/2025-12-10-gcp-lb/14.png)

<br>

After its created, now we have a working Application Load Balancer

![x](/static/2025-12-10-gcp-lb/15.png)

![x](/static/2025-12-10-gcp-lb/16.png)

<br>

Here we can see the configured backends and the health status of its members

![x](/static/2025-12-10-gcp-lb/17.png)

![x](/static/2025-12-10-gcp-lb/18.png)

<br>

On Frontend, we can see the assigned Public IP Address

![x](/static/2025-12-10-gcp-lb/19.png)

<br>

And accessing it shows us the load balanced web servers

![x](/static/2025-12-10-gcp-lb/20.png)

![x](/static/2025-12-10-gcp-lb/21.png)

<br>

## Cloud Armor

Next we will configure Cloud Armor to better protect our web servers, to do that we'll create a new Cloud Armor Policy with Backend type at Application Layer

![x](/static/2025-12-10-gcp-lb/22.png)

<br>

After that we add a new rule to apply throttling for IP Address that has more than 5 requests in 1 minute

![x](/static/2025-12-10-gcp-lb/23.png)

<br>

And for the second scenario we will add another rule that blocks access from IP originating from Russia

![x](/static/2025-12-10-gcp-lb/24.png)

<br>

Here's the final Policy with the configured rules

![x](/static/2025-12-10-gcp-lb/25.png)

<br>

Lastly we can attach this policy into the Backend Service by setting the target

![x](/static/2025-12-10-gcp-lb/26.png)

<br>

Now lets try the throttling rule, when we refresh the page 5 times we will get this error

![x](/static/2025-12-10-gcp-lb/27.png)

<br>


Next if we try accesing it from any other country, it should be accessible just fine

![x](/static/2025-12-10-gcp-lb/28.png)

<br>

But accessing from Russia will be denied

![x](/static/2025-12-10-gcp-lb/29.png)

<br>

