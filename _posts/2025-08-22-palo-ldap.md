---
title: Palo Alto User-ID LDAP
date: 2025-08-22 07:30:00 +0700
categories: [Security, Palo Alto]
tags: [Palo Alto]
---

Palo Alto **User-ID** integrates with **LDAP directories** to learn user-to-group mappings, then correlates those with IP addresses gathered from sources such as login events, agents, or probes. This allows the firewall to enforce security policies based on **user identity** instead of just IP, ensuring rules follow the authenticated user across devices and sessions.

<br>

First on the Inside Zone, we enable User Identification. This lets the firewall map IP addresses to user identities retrieved from LDAP.

![x](/static/2025-08-22-palo-ldap/01.png)

<br>

Next on User Identification, hit the Gear Icon and setup the LDAP credentials

![x](/static/2025-08-22-palo-ldap/02.png)

<br>

Then on Server Monitoring, add the LDAP Server Address using WMI Transport Protocol

![x](/static/2025-08-22-palo-ldap/03.png)

> WMI (Windows Management Instrumentation) is used to query Windows Domain Controller security logs directly, allowing the firewall to learn user login events and map usernames to IP addresses. Itâ€™s an agentless method, requiring admin credentials on the DC, and provides real-time user-to-IP mapping for User-ID.

<br>

Commit the changes and make sure the status becomes Connected

![x](/static/2025-08-22-palo-ldap/04.png)

<br>

Next on Server Profiles, create a new LDAP Profile pointing to AD. This will be used to retrieve LDAP Groups and Users

![x](/static/2025-08-22-palo-ldap/05.png)

<br>

Back on User Identification, create a new Group Mapping and select the desired groups to use

![x](/static/2025-08-22-palo-ldap/06.png)

<br>

That should do it for the User-ID configuration, but when comitting and testing the configuration, we hit an error 'Access Denied' on Server Monitoring configuration

![x](/static/2025-08-22-palo-ldap/08.png)

<br>

Looking over on the AD Server's Event Viewer, we can see Palo Alto is unable to query the Domain Controller via WMI due to permission issue. I haven't found a reliable way to mitigate this issue so we will proceed with alternative transport protocol replacing WMI

![x](/static/2025-08-22-palo-ldap/09.png)

<br>

The alternative is to use WinRM-HTTP. Using WinRM-HTTP instead of WMI lets firewall query AD login events over a more modern, firewall-friendly protocol without DCOM errors. Kerberos is required because it encrypts the session and provides secure mutual authentication, so we need to create a Kerberos Profile

![x](/static/2025-08-22-palo-ldap/10.png)

<br>

Next on the User Identification, we attach the Kerberos Profile here

![x](/static/2025-08-22-palo-ldap/11.png)

<br>

And lastly we change the Transport Protocol from WMI to WinRM-HTTP, we also need to use FQDN instead of IP Address for the Network Address

![x](/static/2025-08-22-palo-ldap/12.png)

<br>

Now the status has become connected, resolving our previous issue

![x](/static/2025-08-22-palo-ldap/13.png)

<br>

We can use the retrieved User Groups in the Policy now for more granular control

![x](/static/2025-08-22-palo-ldap/14.png)

<br>

And traffic from domain users are now mapped to their respective users

![x](/static/2025-08-22-palo-ldap/15.png)

<br>

We can also run 'show user ip-user-mapping all' to see all mapped users

![x](/static/2025-08-22-palo-ldap/16.png)

<br>













