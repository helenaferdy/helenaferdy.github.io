---
title: VXLAN
date: 2024-01-30 11:30:00 +0700
categories: [Networking, VXLAN]
tags: [VXLAN]
---

VXLAN, or Virtual Extensible LAN, is a network virtualization technology that enables the creation of virtualized Layer 2 networks over an existing Layer 3 infrastructure. VXLAN overlays a Layer 2 network on top of a Layer 3 infrastructure, allowing for more flexible and scalable network design.

<br>
<br>

## VXLAN Configuration

In this configuration we have 1 Spine and 2 Leaves, first we'll configure the OSPF so all the siwtches can communicate properly to each other

![x](/static/2024-01-30-vxlan/02.png)

<br>

> spine-1

```text
conf
 feature ospf
 router ospf 1
  router-id 99.0.0.1

 int e1/1
 no switchport
 ip add 11.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown

 int e1/2
 no switchport
 ip add 12.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown
```

<br>

> leaf-1

```text
 conf
 feature ospf
 router ospf 1
 router-id 100.0.0.2

 int e1/1
  no switch
  ip add 12.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut

 int lo0
  ip add 100.0.0.2/32
  ip router ospf 1 area 0
```

<br>

> leaf-2

```text
 conf
 feature ospf
 router ospf 1
 router-id 100.0.0.1

 int e1/1
  no switch
  ip add 11.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut

 int lo0
  ip add 100.0.0.1/32
  ip router ospf 1 area 0
```


# STEP 2

<br>

```text
conf
 feature nv overlay

 int nve1
  no shut
  source-interface loopback0
```

<br>

# STEP 3

```text
conf
 feature vn-segment-vlan-based

 vlan 10
  vn-segment 1000
  
 vlan 20
  vn-segment 2000
```

<br>


# STEP 4

```text
conf
 int nve1
  member vni 1000
   ingress-replication protocol static
   peer-ip 100.0.0.2
  member vni 2000
   ingress-replication protocol static
   peer-ip 100.0.0.2
```

<br>

```text
conf
 int nve1
  member vni 1000
   ingress-replication protocol static
   peer-ip 100.0.0.1
  member vni 2000
   ingress-replication protocol static
   peer-ip 100.0.0.1
```


# STEP 5

```text
conf
 int e1/6
  switchport access vlan 10
  
 int e1/7
  switchport access vlan 20
```

## STEP 6

```text
conf
 int e1/3
 no switchport
 ip add 13.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown
```

```text

conf
 feature ospf
 router ospf 1
  router-id 99.0.0.2

 int e1/1
 no switchport
 ip add 21.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown

 int e1/2
 no switchport
 ip add 22.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown

 int e1/3
 no switchport
 ip add 23.0.0.1/30
 ip router ospf 1 area 0
 ip ospf network point-to-point
 no shutdown

```


## STEP 7


```text
conf
 int e1/1
  no switch
  ip add 21.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut
```

```text
conf
 int e1/1
  no switch
  ip add 22.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut
```

```text
conf
 feature ospf
 router ospf 1
 router-id 100.0.0.3

 int e1/1
  no switch
  ip add 13.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut

 int e1/2
  no switch
  ip add 23.0.0.2/30
  ip router ospf 1 area 0
  ip ospf network point-to-point
  no shut

 int lo0
  ip add 100.0.0.3/32
  ip router ospf 1 area 0

 int e1/6
  switchport access vlan 10
  
 int e1/7
  switchport access vlan 20
```


## STEP 8

```text
conf
 int nve1
  member vni 1000
   ingress-replication protocol static
   peer-ip 100.0.0.3
  member vni 2000
   ingress-replication protocol static
   peer-ip 100.0.0.3
```

```text
conf
 feature nv overlay
 feature vn-segment-vlan-based

 vlan 10
  vn-segment 1000
 vlan 20
  vn-segment 2000

 int nve1
  no shut
  source-interface loopback0
  member vni 1000
   ingress-replication protocol static
   peer-ip 100.0.0.1
   peer-ip 100.0.0.2
  member vni 2000
   ingress-replication protocol static
   peer-ip 100.0.0.1
   peer-ip 100.0.0.2
```
